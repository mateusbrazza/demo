ğŸ”¥ Fluxo completo do endpoint POST /consents
UsuÃ¡rio â†’ envia uma requisiÃ§Ã£o POST com headers + body.

ğŸ‘‡ A aplicaÃ§Ã£o faz:

Recebe a requisiÃ§Ã£o no ConsentController#createConsent.

ValidaÃ§Ã£o de headers obrigatÃ³rios:

Authorization obrigatÃ³rio (se faltar â†’ 401 Unauthorized).

x-idempotency-key obrigatÃ³rio (se faltar â†’ 400 Bad Request).

x-fapi-interaction-id obrigatÃ³rio (se faltar â†’ 400 Bad Request).

ValidaÃ§Ã£o do body da requisiÃ§Ã£o:

Campo data nÃ£o pode ser nulo.

Dentro de data, o loggedUser e permissions devem estar corretos.

Dentro de loggedUser, o document (com identification e rel) deve existir e ser vÃ¡lido.

PermissÃµes:

NÃ£o pode misturar Fase 2 e Fase 3.

Se for Fase 2:

NÃ£o pode mandar apenas RESOURCES_READ sozinho.

Ã‰ obrigatÃ³rio mandar RESOURCES_READ junto com outras permissÃµes vÃ¡lidas da fase 2.

Se for Fase 3:

Todas as permissÃµes precisam pertencer ao mesmo grupo.

Se for grupo com duas permissÃµes obrigatÃ³rias (ex: QUOTE_AUTO_LEAD_CREATE e QUOTE_AUTO_LEAD_UPDATE), deve mandar as duas.

IdempotÃªncia:

Verifica se jÃ¡ existe um consentimento com o mesmo x-idempotency-key no cache.

Se existir:

Se a requisiÃ§Ã£o for idÃªntica, retorna o consentimento jÃ¡ criado (200 OK).

Se for diferente, lanÃ§a erro 422 Unprocessable Entity (mudou o conteÃºdo).

GeraÃ§Ã£o do consentimento:

Gera o consentId no formato urn:seuprojeto:{UUID}.

Define creationDateTime e statusUpdateDateTime como agora (UTC).

Define status como AWAITING_AUTHORISATION.

Armazena o consentimento no cache.

Resposta:

HTTP 201 Created.

Body no formato definido no YAML (data, links, meta).

ğŸš€ Fluxo completo do endpoint GET /consents/{consentId}
UsuÃ¡rio â†’ envia uma requisiÃ§Ã£o GET com headers.

ğŸ‘‡ A aplicaÃ§Ã£o faz:

Recebe a requisiÃ§Ã£o no ConsentController#getConsent.

ValidaÃ§Ã£o de headers obrigatÃ³rios:

Authorization obrigatÃ³rio (se faltar â†’ 401 Unauthorized).

x-fapi-interaction-id obrigatÃ³rio (se faltar â†’ 400 Bad Request).

Busca no cache pelo consentId.

Se encontrar:

Retorna o consentimento (200 OK).

Se nÃ£o encontrar:

LanÃ§a 404 Not Found.

ğŸ§¹ Fluxo completo do endpoint DELETE /consents/{consentId}
UsuÃ¡rio â†’ envia uma requisiÃ§Ã£o DELETE com headers.

ğŸ‘‡ A aplicaÃ§Ã£o faz:

Recebe a requisiÃ§Ã£o no ConsentController#deleteConsent.

ValidaÃ§Ã£o de headers obrigatÃ³rios:

Authorization obrigatÃ³rio (se faltar â†’ 401 Unauthorized).

x-fapi-interaction-id obrigatÃ³rio (se faltar â†’ 400 Bad Request).

Busca no cache pelo consentId.

Se encontrar:

Remove o consentimento do cache.

Retorna 204 No Content.

Se nÃ£o encontrar:

LanÃ§a 404 Not Found.